<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prime E-Store - Order System</title>
  <style>
    :root {
      --primary: #4361ee;
      --primary-dark: #3a0ca3;
      --secondary: #f72585;
      --success: #4cc9f0;
      --danger: #f94144;
      --warning: #f8961e;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --light-gray: #e9ecef;
      --white: #ffffff;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }
    
    body {
      background-color: #f5f7ff;
      color: var(--dark);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 15px;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: var(--white);
      padding: 15px 0;
      text-align: center;
      border-radius: 0 0 15px 15px;
      box-shadow: 0 4px 20px rgba(67, 97, 238, 0.3);
      margin-bottom: 20px;
      position: relative;
    }
    
    .header-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
    }
    
    .logo-icon {
      margin-right: 8px;
    }
    
    .admin-btn {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s ease;
    }
    
    .admin-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .notification {
      position: fixed;
      top: 15px;
      right: 15px;
      background: var(--success);
      color: var(--white);
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      z-index: 1000;
      display: none;
      animation: fadeIn 0.3s ease-out;
      max-width: 90%;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .notification.error {
      background: var(--danger);
    }
    
    .dashboard {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    @media (min-width: 768px) {
      .dashboard {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .card {
      background: var(--white);
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      border: 1px solid rgba(0,0,0,0.05);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--light-gray);
    }
    
    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-icon {
      font-size: 1.1rem;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: var(--dark);
      font-size: 0.9rem;
    }
    
    input, textarea, select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--light-gray);
      border-radius: 6px;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }
    
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }
    
    .readonly-input {
      background-color: var(--light-gray);
      cursor: not-allowed;
    }
    
    .search-box {
      margin-bottom: 15px;
      position: relative;
    }
    
    .search-box input {
      padding-left: 40px;
    }
    
    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
    }
    
    .products-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 15px;
    }
    
    @media (min-width: 480px) {
      .products-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (min-width: 768px) {
      .products-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    .product-card {
      background: var(--white);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 3px 8px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
      border: 1px solid var(--light-gray);
      display: flex;
      flex-direction: column;
    }
    
    .product-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      border-color: var(--primary);
    }
    
    .product-image-container {
      position: relative;
      cursor: pointer;
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--light-gray);
    }
    
    .product-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .product-body {
      padding: 10px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }
    
    .product-title {
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--dark);
      line-height: 1.3;
    }
    
    .product-price {
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 8px;
      font-size: 0.85rem;
    }
    
    .quantity-control {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: auto;
    }
    
    .quantity-btn {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--primary);
      color: var(--white);
      border: none;
      font-size: 0.8rem;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    
    .quantity-btn:hover {
      background: var(--primary-dark);
      transform: scale(1.1);
    }
    
    .quantity-btn:disabled {
      background: var(--gray);
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    .quantity-value {
      font-weight: 600;
      min-width: 22px;
      text-align: center;
      font-size: 0.85rem;
    }
    
    .add-12-btn {
      background: var(--secondary);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .add-12-btn:hover {
      background: #d61a6b;
    }
    
    .summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }
    
    .summary-label {
      color: var(--gray);
    }
    
    .summary-value {
      font-weight: 600;
    }
    
    .total-amount {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--primary);
      margin-top: 15px;
      padding-top: 10px;
      border-top: 1px solid var(--light-gray);
      text-align: right;
    }
    
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .btn {
      padding: 12px 16px;
      border: none;
      border-radius: 6px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      flex: 1;
    }
    
    .btn-primary {
      background: var(--primary);
      color: var(--white);
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
    }
    
    .btn-primary:disabled {
      background: var(--gray);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .btn-danger {
      background: var(--danger);
      color: var(--white);
    }
    
    .btn-danger:hover {
      background: #d03437;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(248, 65, 68, 0.3);
    }
    
    .btn-success {
      background: var(--success);
      color: var(--white);
    }
    
    .btn-success:hover {
      background: #3ab7d8;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(76, 201, 240, 0.3);
    }
    
    .btn-warning {
      background: var(--warning);
      color: var(--white);
    }
    
    .btn-warning:hover {
      background: #e68a19;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(248, 150, 30, 0.3);
    }
    
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 16px;
      font-size: 0.75rem;
      font-weight: 600;
      background: var(--light);
      color: var(--dark);
    }
    
    .badge-primary {
      background: var(--primary);
      color: var(--white);
    }
    
    .badge-success {
      background: var(--success);
      color: var(--white);
    }
    
    .badge-warning {
      background: var(--warning);
      color: var(--white);
    }
    
    .badge-danger {
      background: var(--danger);
      color: var(--white);
    }
    
    .order-id {
      font-family: 'Courier New', Courier, monospace;
      font-weight: 600;
      color: var(--primary);
      font-size: 0.9rem;
    }
    
    /* Loading spinner */
    .spinner {
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: var(--white);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Image modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.9);
      overflow: auto;
    }
    
    .modal-content {
      display: block;
      margin: auto;
      max-width: 90%;
      max-height: 90%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    .close {
      position: absolute;
      top: 15px;
      right: 35px;
      color: #f1f1f1;
      font-size: 40px;
      font-weight: bold;
      transition: 0.3s;
      cursor: pointer;
    }
    
    .close:hover {
      color: #bbb;
    }
    
    /* Admin Panel Styles */
    .admin-modal {
      display: none;
      position: fixed;
      z-index: 1002;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      overflow: auto;
    }
    
    .admin-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 30px rgba(0,0,0,0.3);
      width: 90%;
      max-width: 1000px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }
    
    .admin-close {
      position: absolute;
      top: 15px;
      right: 25px;
      font-size: 28px;
      font-weight: bold;
      color: #aaa;
      cursor: pointer;
    }
    
    .admin-close:hover {
      color: var(--danger);
    }
    
    .admin-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--light-gray);
    }
    
    .admin-tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.2s ease;
    }
    
    .admin-tab.active {
      border-bottom-color: var(--primary);
      color: var(--primary);
      font-weight: 600;
    }
    
    .admin-tab:hover:not(.active) {
      border-bottom-color: var(--gray);
    }
    
    .admin-tab-content {
      display: none;
    }
    
    .admin-tab-content.active {
      display: block;
    }
    
    .login-form {
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .login-form h2 {
      text-align: center;
      margin-bottom: 20px;
      color: var(--primary);
    }
    
    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    
    @media (min-width: 768px) {
      .dashboard-stats {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    .stat-card {
      background: var(--white);
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
      text-align: center;
    }
    
    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
      margin: 10px 0;
    }
    
    .stat-label {
      color: var(--gray);
      font-size: 0.9rem;
    }
    
    .orders-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    .orders-table th, .orders-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--light-gray);
    }
    
    .orders-table th {
      background-color: var(--light);
      font-weight: 600;
    }
    
    .orders-table tr:hover {
      background-color: rgba(67, 97, 238, 0.05);
    }
    
    .order-details {
      margin-top: 10px;
      padding: 10px;
      background: var(--light);
      border-radius: 6px;
      font-size: 0.85rem;
    }
    
    .order-details-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }
    
    .order-products {
      margin-top: 10px;
    }
    
    .order-product {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px dashed var(--light-gray);
    }
    
    .order-product:last-child {
      border-bottom: none;
    }
    
    .status-select {
      padding: 5px 8px;
      border-radius: 4px;
      border: 1px solid var(--light-gray);
      font-size: 0.8rem;
      cursor: pointer;
    }
    
    .status-pending {
      background-color: #fff3cd;
      color: #856404;
    }
    
    .status-processing {
      background-color: #cce5ff;
      color: #004085;
    }
    
    .status-delivered {
      background-color: #d4edda;
      color: #155724;
    }
    
    .status-cancelled {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .admin-title {
      font-size: 1.5rem;
      color: var(--primary);
      font-weight: 700;
    }
    
    .logout-btn {
      background: var(--danger);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .logout-btn:hover {
      background: #d03437;
    }
    
    .filter-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    
    .filter-select {
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid var(--light-gray);
      font-size: 0.9rem;
      cursor: pointer;
      min-width: 150px;
    }
    
    .order-actions {
      display: flex;
      gap: 5px;
    }
    
    .action-btn {
      padding: 5px 8px;
      border: none;
      border-radius: 4px;
      font-size: 0.8rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 3px;
    }
    
    .action-btn.view {
      background: var(--primary);
      color: white;
    }
    
    .action-btn.print {
      background: var(--gray);
      color: white;
    }
    
    .action-btn.delete {
      background: var(--danger);
      color: white;
    }
    
    .order-modal {
      display: none;
      position: fixed;
      z-index: 1003;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      overflow: auto;
    }
    
    .order-modal-content {
      background-color: #fefefe;
      margin: 5% auto;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 30px rgba(0,0,0,0.3);
      width: 90%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }
    
    .order-modal-close {
      position: absolute;
      top: 15px;
      right: 25px;
      font-size: 28px;
      font-weight: bold;
      color: #aaa;
      cursor: pointer;
    }
    
    .order-modal-close:hover {
      color: var(--danger);
    }
    
    .order-modal-title {
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 20px;
      font-weight: 700;
    }
    
    .no-orders {
      text-align: center;
      padding: 20px;
      color: var(--gray);
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <span class="logo-icon">📦</span>
          <span>Prime E-Store</span>
        </div>
        <button class="admin-btn" id="adminBtn">
          <span>🔒 Admin</span>
        </button>
      </div>
    </div>
  </header>
  
  <div class="notification" id="notification"></div>
  
  <!-- Image modal -->
  <div id="imageModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="modalImage">
  </div>
  
  <!-- Admin Panel Modal -->
  <div id="adminModal" class="admin-modal">
    <div class="admin-content">
      <span class="admin-close">&times;</span>
      <div class="admin-tabs">
        <div class="admin-tab active" data-tab="login">Login</div>
        <div class="admin-tab" data-tab="dashboard">Dashboard</div>
      </div>
      
      <div class="admin-tab-content active" id="loginTab">
        <div class="login-form">
          <h2>Admin Login</h2>
          <div class="form-group">
            <label for="adminUsername">Username</label>
            <input type="text" id="adminUsername" placeholder="Enter admin username">
          </div>
          <div class="form-group">
            <label for="adminPassword">Password</label>
            <input type="password" id="adminPassword" placeholder="Enter password">
          </div>
          <button class="btn btn-primary" id="loginBtn">Login</button>
        </div>
      </div>
      
      <div class="admin-tab-content" id="dashboardTab">
        <div class="admin-header">
          <h2 class="admin-title">Admin Dashboard</h2>
          <button class="logout-btn" id="logoutBtn">
            <span>🚪</span>
            <span>Logout</span>
          </button>
        </div>
        
        <div class="dashboard-stats">
          <div class="stat-card">
            <div class="stat-label">Today's Orders</div>
            <div class="stat-value" id="todayOrdersStat">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Today's Revenue</div>
            <div class="stat-value" id="todayRevenueStat">0.00</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Pending Orders</div>
            <div class="stat-value" id="pendingOrdersStat">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Delivered Orders</div>
            <div class="stat-value" id="deliveredOrdersStat">0</div>
          </div>
        </div>
        
        <div class="filter-controls">
          <select class="filter-select" id="statusFilter">
            <option value="all">All Statuses</option>
            <option value="pending">Pending</option>
            <option value="processing">Processing</option>
            <option value="delivered">Delivered</option>
            <option value="cancelled">Cancelled</option>
          </select>
          
          <select class="filter-select" id="dateFilter">
            <option value="today">Today</option>
            <option value="yesterday">Yesterday</option>
            <option value="week">This Week</option>
            <option value="month">This Month</option>
            <option value="all">All Time</option>
          </select>
          
          <input type="text" class="filter-select" id="searchFilter" placeholder="Search orders...">
        </div>
        
        <div class="table-responsive">
          <table class="orders-table">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Shop Name</th>
                <th>Phone</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="ordersTableBody">
              <!-- Orders will be populated here -->
            </tbody>
          </table>
          <div id="noOrdersMessage" class="no-orders" style="display: none;">
            No orders found matching your criteria
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Order Details Modal -->
  <div id="orderModal" class="order-modal">
    <div class="order-modal-content">
      <span class="order-modal-close">&times;</span>
      <h2 class="order-modal-title">Order Details</h2>
      <div id="orderDetailsContent"></div>
    </div>
  </div>
  
  <div class="container">
    <div class="dashboard">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-icon">📝</span>
            Customer Information
          </h2>
          <span class="badge badge-primary" id="orderCounter">Orders Today: 0</span>
        </div>
        
        <div class="form-group">
          <label for="shopName">Shop Name *</label>
          <input type="text" id="shopName" placeholder="Enter shop name" required>
        </div>
        
        <div class="form-group">
          <label for="phone">Phone Number *</label>
          <input type="tel" id="phone" placeholder="Enter phone number" required>
        </div>
        
        <div class="form-group">
          <label for="address">Delivery Address</label>
          <textarea id="address" rows="2" placeholder="Enter delivery address"></textarea>
        </div>
        
        <div class="form-group">
          <label for="notes">Order Notes</label>
          <textarea id="notes" rows="3" placeholder="Any special instructions"></textarea>
        </div>
        
        <div class="form-group">
          <label for="orderId">Order ID</label>
          <input type="text" id="orderId" class="readonly-input" readonly>
        </div>
        
        <div class="form-group">
          <label for="orderDate">Order Date</label>
          <input type="text" id="orderDate" class="readonly-input" readonly>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-icon">💰</span>
            Order Summary
          </h2>
        </div>
        
        <div class="form-group">
          <label for="discount">Discount (%)</label>
          <input type="number" id="discount" min="0" max="100" value="0">
        </div>
        
        <div class="form-group">
          <label for="vat">VAT (%)</label>
          <input type="number" id="vat" min="0" max="100" value="0">
        </div>
        
        <div class="form-group">
          <label for="shipping">Shipping Cost ()</label>
          <input type="number" id="shipping" min="0" value="0">
        </div>
        
        <div class="summary-item">
          <span class="summary-label">Subtotal:</span>
          <span class="summary-value" id="subtotal">0.00</span>
        </div>
        
        <div class="summary-item">
          <span class="summary-label">Discount:</span>
          <span class="summary-value" id="discountAmount">-0.00</span>
        </div>
        
        <div class="summary-item">
          <span class="summary-label">VAT:</span>
          <span class="summary-value" id="vatAmount">0.00</span>
        </div>
        
        <div class="summary-item">
          <span class="summary-label">Shipping:</span>
          <span class="summary-value" id="shippingCost">0.00</span>
        </div>
        
        <div class="total-amount" id="total">
          Total: 0.00
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">
          <span class="card-icon">🛍️</span>
          Products
        </h2>
      </div>
      
      <div class="search-box">
        <span class="search-icon">🔍</span>
        <input type="text" id="searchInput" placeholder="Search products...">
      </div>
      
      <div class="products-grid" id="productList"></div>
    </div>
    
    <div class="action-buttons">
      <button class="btn btn-primary" id="submitBtn">
        <span>Submit Order</span>
      </button>
      <button class="btn btn-danger" id="cancelBtn">
        <span>Cancel Order</span>
      </button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAnKnvDoCLDlZB0bP3OznGES9sfvdkvkE0",
      authDomain: "er-mailer2.firebaseapp.com",
      databaseURL: "https://er-mailer2-default-rtdb.firebaseio.com",
      projectId: "er-mailer2",
      storageBucket: "er-mailer2.firebasestorage.app",
      messagingSenderId: "1084352854404",
      appId: "1:1084352854404:web:519ebd65f7a1a2f5f245d1"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Products data (extended to 100 items)
    const products = [
      {id:1,name:"8 Pin Combined Switch Board",price:20.50,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/8%20Pin%20Combined%20Switch%20Board.jpg"},
      {id:2,name:"6 Pin Combined Switch Board",price:2.50,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/6%20Pin%20Combined%20Switch%20Board.png"},
      {id:3,name:"4 Pin Combined Switch Board",price:1.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/4%20Pin%20Combined%20Switch%20Board.jpg"},
      {id:4,name:"2 Pin Multi Socket (T. Adapter)",price:1.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/2%20Pin%20Multi%20Socket%20(T.%20Adapter).jpg"},
      {id:5,name:"2 Pin  Round Plug",price:3.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/2%20Pin%20%20Round%20Plug.jpg"},
      {id:6,name:"3 Pin Plug 16 Amp",price:1.50,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/3%20Pin%20Plug%2016%20Amp.jpg"},
      {id:7,name:"3 Pin Plug 13 Amp",price:15.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/3%20Pin%20Plug%2013%20Amp.jpg"},
      {id:8,name:"2-Pin-Plug-High-Quality-Msr",price:20.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/2-Pin-Plug-High-Quality-Msr.jpg"},
      {id:9,name:"2-Pin-Plug-High-Quality",price:8.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/2-Pin-Plug-High-Quality.jpg"},
      {id:10,name:"3 Pin Mini Round Pin Industrial Unfused Small Minis Plug",price:120.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/2MP%203%20Pin%20Mini%20Round%20Pin%20Industrial%20Unfused%20Small%20Minis%20Plug.jpg"},
      {id:11,name:"Switch",price:50.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/Switch.jpg"},
      {id:12,name:"Socket",price:350.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/Socket.png"},
      {id:13,name:"Regulator",price:0.50,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/Regulator.jpg"},
      {id:14,name:"Indicator",price:0.50,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/Indicator.jpg"},
      {id:15,name:"Fuse Cut Out  Switch",price:3.50,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/Fuse%20Cut%20Out%20%20Switch.jpg"},
      {id:16,name:"Electric Tape",price:5.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/Electric%20Tape.jpeg"},
      {id:17,name:"Neon tester",price:1.20,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/Neon%20tester.png"},
      {id:18,name:"Philips Electric Tester (AC Indicator - Voltage Detector)",price:1.20,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/Philips%20Electric%20Tester%20(AC%20Indicator%20-%20Voltage%20Detector).jpg"},
      {id:19,name:"Tester 2 in 1 One tester for two devices!",price:4.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/Tester%202%20in%201%20One%20tester%20for%20two%20devices!.jpg"},
      {id:20,name:"Circuit Breaker Box (One Way)",price:25.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/Circuit%20Breaker%20Box%20(One%20Way).jpg"},
      {id:21,name:"1 Gang Outer Box",price:15.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/1%20Gang%20Outer%20Box.png"},
      {id:22,name:"2 Gang Outer Box",price:10.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/2%20Gang%20Outer%20Box.png"},
      {id:23,name:"3 Gang Outer Box",price:25.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/3%20Gang%20Outer%20Box.png"},
      {id:24,name:"1 Switch Modular Box",price:12.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/1%20Switch%20Modular%20Box.png"},
      {id:25,name:"2 Switch Modular Box",price:15.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/2%20Switch%20Modular%20Box.jpg"},
      {id:26,name:"3 Switch Modular Box",price:45.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/3%20Switch%20Modular%20Box.png"},
      {id:27,name:"4 Switch Modular Box",price:30.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/4%20Switch%20Modular%20Box.jpg"},
      {id:28,name:"14/76 Flexible Electrical Wire Twisted Copper Cable Red Black Pair",price:2.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/1476%20Flexible%20Electrical%20Wire%20Twisted%20Copper%20Cable%20Red%20Black%20Pair.png"},
      {id:29,name:"Aluminum Cable 7+7 Gej",price:80.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/Aluminum%20Cable%207%2B7%20Gej.jpg"},
      {id:30,name:"Twin Core Electric Cable - 1 Coil 23 76",price:120.00,img:"https://raw.githubusercontent.com/ER-MAILER/E-Store/main/StoreIcon/Twin%20Core%20Electric%20Cable%20-%201%20Coil%2023%2076.webp"},
      {id:31,name:"Copper Wire 1mm",price:3.50,img:"https://via.placeholder.com/150?text=Copper+Wire"},
      {id:32,name:"Copper Wire 2mm",price:5.00,img:"https://via.placeholder.com/150?text=Copper+Wire+2mm"},
      {id:33,name:"Extension Cord 5m",price:12.00,img:"https://via.placeholder.com/150?text=Extension+Cord"},
      {id:34,name:"Extension Cord 10m",price:20.00,img:"https://via.placeholder.com/150?text=Extension+Cord+10m"},
      {id:35,name:"Power Strip 4 Port",price:15.00,img:"https://via.placeholder.com/150?text=Power+Strip"},
      {id:36,name:"Power Strip 6 Port",price:22.00,img:"https://via.placeholder.com/150?text=Power+Strip+6"},
      {id:37,name:"LED Bulb 5W",price:4.50,img:"https://via.placeholder.com/150?text=LED+Bulb"},
      {id:38,name:"LED Bulb 10W",price:7.00,img:"https://via.placeholder.com/150?text=LED+Bulb+10W"},
      {id:39,name:"CFL Bulb 15W",price:3.50,img:"https://via.placeholder.com/150?text=CFL+Bulb"},
      {id:40,name:"CFL Bulb 20W",price:5.00,img:"https://via.placeholder.com/150?text=CFL+Bulb+20W"},
      {id:41,name:"Tube Light 20W",price:8.00,img:"https://via.placeholder.com/150?text=Tube+Light"},
      {id:42,name:"Tube Light 40W",price:12.00,img:"https://via.placeholder.com/150?text=Tube+Light+40W"},
      {id:43,name:"Choke 20W",price:6.00,img:"https://via.placeholder.com/150?text=Choke+20W"},
      {id:44,name:"Choke 40W",price:9.00,img:"https://via.placeholder.com/150?text=Choke+40W"},
      {id:45,name:"Starter for Tube Light",price:1.50,img:"https://via.placeholder.com/150?text=Starter"},
      {id:46,name:"Ceiling Fan Regulator",price:7.00,img:"https://via.placeholder.com/150?text=Fan+Regulator"},
      {id:47,name:"Wall Fan Regulator",price:6.00,img:"https://via.placeholder.com/150?text=Wall+Fan+Regulator"},
      {id:48,name:"Ceiling Fan Capacitor",price:3.00,img:"https://via.placeholder.com/150?text=Fan+Capacitor"},
      {id:49,name:"Table Fan Capacitor",price:2.50,img:"https://via.placeholder.com/150?text=Table+Fan+Capacitor"},
      {id:50,name:"Exhaust Fan",price:25.00,img:"https://via.placeholder.com/150?text=Exhaust+Fan"},
      {id:51,name:"Table Fan",price:35.00,img:"https://via.placeholder.com/150?text=Table+Fan"},
      {id:52,name:"Pedestal Fan",price:45.00,img:"https://via.placeholder.com/150?text=Pedestal+Fan"},
      {id:53,name:"Wall Fan",price:30.00,img:"https://via.placeholder.com/150?text=Wall+Fan"},
      {id:54,name:"Cooling Fan",price:15.00,img:"https://via.placeholder.com/150?text=Cooling+Fan"},
      {id:55,name:"Fan Blade 1200mm",price:12.00,img:"https://via.placeholder.com/150?text=Fan+Blade"},
      {id:56,name:"Fan Blade 900mm",price:10.00,img:"https://via.placeholder.com/150?text=Fan+Blade+900"},
      {id:57,name:"Fan Blade 600mm",price:8.00,img:"https://via.placeholder.com/150?text=Fan+Blade+600"},
      {id:58,name:"Fan Guard",price:5.00,img:"https://via.placeholder.com/150?text=Fan+Guard"},
      {id:59,name:"Fan Motor",price:40.00,img:"https://via.placeholder.com/150?text=Fan+Motor"},
      {id:60,name:"Fan Speed Controller",price:8.00,img:"https://via.placeholder.com/150?text=Fan+Controller"},
      {id:61,name:"Iron Box",price:25.00,img:"https://via.placeholder.com/150?text=Iron+Box"},
      {id:62,name:"Water Heater",price:50.00,img:"https://via.placeholder.com/150?text=Water+Heater"},
      {id:63,name:"Immersion Rod",price:15.00,img:"https://via.placeholder.com/150?text=Immersion+Rod"},
      {id:64,name:"Electric Kettle",price:30.00,img:"https://via.placeholder.com/150?text=Electric+Kettle"},
      {id:65,name:"Toaster",price:20.00,img:"https://via.placeholder.com/150?text=Toaster"},
      {id:66,name:"Mixer Grinder",price:60.00,img:"https://via.placeholder.com/150?text=Mixer+Grinder"},
      {id:67,name:"Juicer",price:35.00,img:"https://via.placeholder.com/150?text=Juicer"},
      {id:68,name:"Blender",price:40.00,img:"https://via.placeholder.com/150?text=Blender"},
      {id:69,name:"Rice Cooker",price:45.00,img:"https://via.placeholder.com/150?text=Rice+Cooker"},
      {id:70,name:"Induction Cooker",price:55.00,img:"https://via.placeholder.com/150?text=Induction+Cooker"},
      {id:71,name:"Microwave Oven",price:120.00,img:"https://via.placeholder.com/150?text=Microwave"},
      {id:72,name:"Electric Oven",price:80.00,img:"https://via.placeholder.com/150?text=Electric+Oven"},
      {id:73,name:"Sandwich Maker",price:25.00,img:"https://via.placeholder.com/150?text=Sandwich+Maker"},
      {id:74,name:"Popcorn Maker",price:30.00,img:"https://via.placeholder.com/150?text=Popcorn+Maker"},
      {id:75,name:"Coffee Maker",price:40.00,img:"https://via.placeholder.com/150?text=Coffee+Maker"},
      {id:76,name:"Electric Grill",price:35.00,img:"https://via.placeholder.com/150?text=Electric+Grill"},
      {id:77,name:"Electric Chimney",price:90.00,img:"https://via.placeholder.com/150?text=Electric+Chimney"},
      {id:78,name:"Exhaust Hood",price:70.00,img:"https://via.placeholder.com/150?text=Exhaust+Hood"},
      {id:79,name:"Water Purifier",price:65.00,img:"https://via.placeholder.com/150?text=Water+Purifier"},
      {id:80,name:"Air Purifier",price:85.00,img:"https://via.placeholder.com/150?text=Air+Purifier"},
      {id:81,name:"Humidifier",price:45.00,img:"https://via.placeholder.com/150?text=Humidifier"},
      {id:82,name:"Dehumidifier",price:75.00,img:"https://via.placeholder.com/150?text=Dehumidifier"},
      {id:83,name:"Air Cooler",price:65.00,img:"https://via.placeholder.com/150?text=Air+Cooler"},
      {id:84,name:"Air Conditioner",price:250.00,img:"https://via.placeholder.com/150?text=AC"},
      {id:85,name:"Refrigerator",price:300.00,img:"https://via.placeholder.com/150?text=Fridge"},
      {id:86,name:"Washing Machine",price:200.00,img:"https://via.placeholder.com/150?text=Washing+Machine"},
      {id:87,name:"Dish Washer",price:180.00,img:"https://via.placeholder.com/150?text=Dish+Washer"},
      {id:88,name:"Vacuum Cleaner",price:70.00,img:"https://via.placeholder.com/150?text=Vacuum+Cleaner"},
      {id:89,name:"Steam Iron",price:35.00,img:"https://via.placeholder.com/150?text=Steam+Iron"},
      {id:90,name:"Sewing Machine",price:90.00,img:"https://via.placeholder.com/150?text=Sewing+Machine"},
      {id:91,name:"Hair Dryer",price:20.00,img:"https://via.placeholder.com/150?text=Hair+Dryer"},
      {id:92,name:"Hair Straightener",price:25.00,img:"https://via.placeholder.com/150?text=Hair+Straightener"},
      {id:93,name:"Electric Shaver",price:30.00,img:"https://via.placeholder.com/150?text=Electric+Shaver"},
      {id:94,name:"Electric Toothbrush",price:15.00,img:"https://via.placeholder.com/150?text=Electric+Toothbrush"},
      {id:95,name:"Massager",price:25.00,img:"https://via.placeholder.com/150?text=Massager"},
      {id:96,name:"Blood Pressure Monitor",price:40.00,img:"https://via.placeholder.com/150?text=BP+Monitor"},
      {id:97,name:"Weighing Scale",price:20.00,img:"https://via.placeholder.com/150?text=Weighing+Scale"},
      {id:98,name:"Thermometer",price:5.00,img:"https://via.placeholder.com/150?text=Thermometer"},
      {id:99,name:"Pedometer",price:15.00,img:"https://via.placeholder.com/150?text=Pedometer"},
      {id:100,name:"Smart Watch",price:50.00,img:"https://via.placeholder.com/150?text=Smart+Watch"}
    ];

    const cart = new Map();
    const productList = document.getElementById('productList');
    const searchInput = document.getElementById('searchInput');
    let totalOrdersToday = 0;
    const notification = document.getElementById('notification');
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    const closeBtn = document.getElementsByClassName("close")[0];
    
    // Admin variables
    const adminModal = document.getElementById('adminModal');
    const adminBtn = document.getElementById('adminBtn');
    const adminCloseBtn = document.querySelector('.admin-close');
    const adminTabs = document.querySelectorAll('.admin-tab');
    const loginBtn = document.getElementById('loginBtn');
    const adminUsername = document.getElementById('adminUsername');
    const adminPassword = document.getElementById('adminPassword');
    const logoutBtn = document.getElementById('logoutBtn');
    const statusFilter = document.getElementById('statusFilter');
    const dateFilter = document.getElementById('dateFilter');
    const searchFilter = document.getElementById('searchFilter');
    const orderModal = document.getElementById('orderModal');
    const orderModalClose = document.querySelector('.order-modal-close');
    const orderDetailsContent = document.getElementById('orderDetailsContent');
    
    let isAdminLoggedIn = false;
    let orders = [];
    
    const ADMIN_CREDENTIALS = {
      username: 'admin',
      password: 'Eyasin'
    };

    // Initialize the app with login check
    function init() {
        checkLoginState(); // Check for saved login state
        
        loadOrdersFromFirebase();
        renderProducts();
        updateTotal();
        generateOrderId();
        setOrderDate();
      
      // Add event listeners
      document.getElementById('discount').addEventListener('input', updateTotal);
      document.getElementById('vat').addEventListener('input', updateTotal);
      document.getElementById('shipping').addEventListener('input', updateTotal);
      document.getElementById('submitBtn').addEventListener('click', submitOrder);
      document.getElementById('cancelBtn').addEventListener('click', resetForm);
      searchInput.addEventListener('input', filterProducts);
      
      // Modal event listeners
      closeBtn.onclick = function() {
        modal.style.display = "none";
      }
      
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
        if (event.target == orderModal) {
          orderModal.style.display = "none";
        }
      }
      
      // Admin panel event listeners
      adminBtn.addEventListener('click', function() {
        adminModal.style.display = "block";
      });
      
      adminCloseBtn.addEventListener('click', function() {
        adminModal.style.display = "none";
      });
      
      logoutBtn.addEventListener('click', adminLogout);
      orderModalClose.addEventListener('click', () => orderModal.style.display = "none");
      
      adminTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          if (tab.dataset.tab === 'dashboard' && !isAdminLoggedIn) {
            showNotification("Please login first", true);
            return;
          }
          
          adminTabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          document.querySelectorAll('.admin-tab-content').forEach(content => {
            content.classList.remove('active');
          });
          document.getElementById(`${tab.dataset.tab}Tab`).classList.add('active');
        });
      });
      
      loginBtn.addEventListener('click', adminLogin);
      
      // Filter event listeners
      statusFilter.addEventListener('change', loadAdminDashboard);
      dateFilter.addEventListener('change', loadAdminDashboard);
      searchFilter.addEventListener('input', loadAdminDashboard);
      
      // Close admin panel when clicking outside
      window.addEventListener('click', (event) => {
        if (event.target === adminModal) {
          adminModal.style.display = "none";
        }
      });
    }

    // Load orders from Firebase
    function loadOrdersFromFirebase() {
      database.ref('orders').on('value', (snapshot) => {
        orders = [];
        const data = snapshot.val();
        if (data) {
          Object.keys(data).forEach(key => {
            orders.push({
              id: key, // Use Firebase key as order ID
              ...data[key]
            });
          });
        }
        
        // Calculate today's orders
        const today = new Date().toLocaleDateString();
        totalOrdersToday = orders.filter(order => {
          const orderDate = new Date(order.date).toLocaleDateString();
          return orderDate === today;
        }).length;
        
        updateOrderCounter();
        
        // If admin is logged in and on dashboard, refresh it
        if (isAdminLoggedIn && document.getElementById('dashboardTab').classList.contains('active')) {
          loadAdminDashboard();
        }
      });
    }

    function generateOrderId() {
      const now = new Date();
      const datePart = now.getFullYear().toString().slice(-2) + 
                       (now.getMonth() + 1).toString().padStart(2, '0') + 
                       now.getDate().toString().padStart(2, '0');
      const randomPart = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
      document.getElementById('orderId').value = `E-Store_${datePart}-${randomPart}`;
    }

    function setOrderDate() {
      document.getElementById('orderDate').value = new Date().toLocaleString('en-GB', {
        day: '2-digit',
        month: 'short', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function showNotification(message, isError = false) {
      notification.textContent = message;
      notification.className = isError ? 'notification error' : 'notification';
      notification.style.display = 'block';
      
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    function updateOrderCounter() {
      document.getElementById('orderCounter').textContent = `Orders Today: ${totalOrdersToday}`;
    }

    function updateTotal() {
      let subtotal = 0;
      cart.forEach((qty, id) => {
        const p = products.find(x => x.id === id);
        if (p) subtotal += p.price * qty;
      });
      
      const discount = parseFloat(document.getElementById('discount').value) || 0;
      const vat = parseFloat(document.getElementById('vat').value) || 0;
      const shipping = parseFloat(document.getElementById('shipping').value) || 0;
      
      const discountAmount = subtotal * discount / 100;
      const vatAmount = subtotal * vat / 100;
      const total = subtotal - discountAmount + vatAmount + shipping;
      
      // Update summary display
      document.getElementById('subtotal').textContent = `${subtotal.toFixed(2)}`;
      document.getElementById('discountAmount').textContent = `-${discountAmount.toFixed(2)}`;
      document.getElementById('vatAmount').textContent = `${vatAmount.toFixed(2)}`;
      document.getElementById('shippingCost').textContent = `${shipping.toFixed(2)}`;
      document.getElementById('total').textContent = `Total: ${total.toFixed(2)}`;
    }

    function changeQty(id, delta) {
      const current = cart.get(id) || 0;
      const newQty = current + delta;
      
      if (newQty <= 0) {
        cart.delete(id);
      } else {
        cart.set(id, newQty);
      }
      
      renderProducts();
      updateTotal();
    }

    function addTwelve(id) {
      const current = cart.get(id) || 0;
      cart.set(id, current + 12);
      
      renderProducts();
      updateTotal();
    }

    function filterProducts() {
      const searchTerm = searchInput.value.toLowerCase();
      renderProducts(searchTerm);
    }

    function renderProducts(searchTerm = '') {
      productList.innerHTML = '';
      
      const filteredProducts = searchTerm 
        ? products.filter(p => p.name.toLowerCase().includes(searchTerm))
        : products;
      
      filteredProducts.forEach(p => {
        const qty = cart.get(p.id) || 0;
        const div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `
          <div class="product-image-container">
            <img src="${p.img}" alt="${p.name}" class="product-image" onclick="zoomImage('${p.img}')" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDIwMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0wIDBoMjAwdjEyMEgweiIgZmlsbD0iI2Y1ZjVmNSIvPgo8dGV4dCB4PSIxMDAiIHk9IjYwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiNjY2MiIHRleHQtYW5jaG9yPSJtaWRkbGUiPk5vIEltYWdlPC90ZXh0Pgo8L3N2Zz4='">
          </div>
          <div class="product-body">
            <h3 class="product-title">${p.name}</h3>
            <div class="product-price">${p.price.toFixed(2)}</div>
            <div class="quantity-control">
              <button class="quantity-btn" onclick="changeQty(${p.id}, -1)" ${qty === 0 ? 'disabled' : ''}>-</button>
              <span class="quantity-value">${qty}</span>
              <button class="quantity-btn" onclick="changeQty(${p.id}, 1)">+</button>
              <button class="add-12-btn" onclick="addTwelve(${p.id})">Add 12</button>
            </div>
          </div>
        `;
        productList.appendChild(div);
      });
    }

    function zoomImage(imgSrc) {
      modal.style.display = "block";
      modalImg.src = imgSrc;
    }

    function validatePhone(phone) {
      const regex = /^(?:\+88|01)?\d{9,11}$/;
      return regex.test(phone.replace(/\s+/g, ''));
    }

    async function submitOrder() {
      const shopName = document.getElementById('shopName').value.trim();
      const phone = document.getElementById('phone').value.trim();
  
      // Validation
      if (!shopName) {
        showNotification("Please enter shop name", true);
        document.getElementById('shopName').focus();
        return;
      }
  
      if (!phone || !validatePhone(phone)) {
        showNotification("Please enter a valid phone number", true);
        document.getElementById('phone').focus();
        return;
      }
  
      if (cart.size === 0) {
        showNotification("Please add at least one product", true);
        return;
      }
  
      try {
        // Disable submit button during processing
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<div class="spinner"></div> Processing...';
    
        // Prepare order data
        const order = {
          orderId: document.getElementById('orderId').value,
          date: new Date().toISOString(),
          shopName,
          phone,
          address: document.getElementById('address').value,
          notes: document.getElementById('notes').value,
          products: Array.from(cart.entries()).map(([id, qty]) => {
            const product = products.find(p => p.id === id);
            return {
              id,
              name: product.name,
              price: product.price,
              quantity: qty
            };
          }),
          subtotal: parseFloat(document.getElementById('subtotal').textContent),
          discount: parseFloat(document.getElementById('discountAmount').textContent.replace('-', '')),
          vat: parseFloat(document.getElementById('vatAmount').textContent),
          shipping: parseFloat(document.getElementById('shippingCost').textContent),
          total: parseFloat(document.getElementById('total').textContent.replace('Total: ', '')),
          status: 'pending'
        };
    
        // Save to Firebase
        const newOrderRef = await database.ref('orders').push();
        await newOrderRef.set(order);
    
        // Generate invoice
        await generateInvoice();
    
        // Show success notification
        showNotification("Order submitted successfully! Invoice downloaded");
    
        // Increment order counter
        totalOrdersToday++;
        updateOrderCounter();
    
        // Reset form for new order
        resetForm();
    
      } catch (error) {
        console.error("Error submitting order:", error);
        showNotification("Error processing order. Please check your internet connection and try again.", true);
      } finally {
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'Submit Order';
      }
    }

    async function generateInvoice() {
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
    
        // Get order information
        const shopName = document.getElementById('shopName').value;
        const phone = document.getElementById('phone').value;
        const address = document.getElementById('address').value;
        const orderId = document.getElementById('orderId').value;
        const orderDate = document.getElementById('orderDate').value;
    
        // Set font and colors
        doc.setFont("helvetica");
        const primaryColor = [67, 97, 238];
        const textColor = [33, 37, 41];
    
        // Header Background
        doc.setFillColor(...primaryColor);
        doc.rect(0, 0, 210, 30, 'F');

        // Left Aligned - Company Info
        doc.setTextColor(255, 255, 255);
        doc.setFont("helvetica", "bold");
        doc.setFontSize(20);
        doc.text('PRIME E-STORE', 15, 12);

        doc.setFont("helvetica", "normal");
        doc.setFontSize(10);
        doc.text('29. Sir Iqbal Road.', 15, 18);
        doc.text('Picture Palace More Khulna. 9100', 15, 24);

        // Right Aligned - Invoice Info
        doc.setFont("helvetica", "bold");
        doc.setFontSize(20);
        doc.text('INVOICE', 195, 12, { align: 'right' });

        doc.setFont("helvetica", "normal");
        doc.setFontSize(10);
        doc.text('Email: er.mailer2@aol.com', 195, 18, { align: 'right' });
        doc.text('Phone: +880 179-554-1326', 195, 24, { align: 'right' });

        // Invoice Details Section
        let yPos = 40;
        doc.setTextColor(...textColor);
        doc.setFontSize(10);
    
        // Left Aligned - Invoice Details
        doc.text(`Invoice: ${orderId}`, 15, yPos);
        doc.text(`Date: ${orderDate}`, 15, yPos + 6);

        // Right Aligned - Customer Info
        doc.setFont("helvetica", "bold");

        // BILL TO: and shop name in same line
        let billToText = 'BILL TO: ' + (shopName && shopName.trim() !== '' ? shopName : '');
        doc.text(billToText, 195, yPos, { align: 'right' });
        doc.setFont("helvetica", "normal");

        // Initialize vertical position for customer info
        let infoY = yPos + 6;

        // Phone (always shown)
        doc.text(`Phone: ${phone}`, 195, infoY, { align: 'right' });
        infoY += 6;

        // Address (if exists)
        if (address && address.trim() !== '') {
          doc.text(`Address: ${address}`, 195, infoY, { align: 'right' });
          infoY += 6;
        }

        // Update yPos for next section
        yPos = infoY;

        // Line separator
        yPos += 4; // Small space before the line
        doc.setDrawColor(200, 200, 200);
        doc.setLineWidth(0.5);
        doc.line(15, yPos, 195, yPos);

        // Items Table Header
        yPos += 10;
        doc.setFont("helvetica", "bold");
        doc.setFontSize(12);
        doc.text('ITEMS', 15, yPos);
        doc.text('QTY', 120, yPos);
        doc.text('PRICE', 140, yPos);
        doc.text('TOTAL', 170, yPos);
        
        // Items table
        doc.setFont("helvetica", "normal");
        doc.setFontSize(10);
        yPos += 8;
        
        let subtotal = 0;
        cart.forEach((qty, id) => {
          const p = products.find(x => x.id === id);
          if (p) {
            const itemTotal = p.price * qty;
            subtotal += itemTotal;
            
            // Alternate row background
            if (yPos % 2 === 0) {
              doc.setFillColor(248, 248, 248);
              doc.rect(15, yPos - 5, 180, 8, 'F');
            }
            
            doc.text(p.name, 20, yPos);
            doc.text(qty.toString(), 125, yPos);
            doc.text(`${p.price.toFixed(2)}`, 145, yPos);
            doc.text(`${itemTotal.toFixed(2)}`, 175, yPos);
            
            yPos += 8;
          }
        });
        
        // Summary
        yPos += 10;
        doc.setDrawColor(200, 200, 200);
        doc.line(120, yPos, 195, yPos);
        
        const discount = parseFloat(document.getElementById('discount').value) || 0;
        const vat = parseFloat(document.getElementById('vat').value) || 0;
        const shipping = parseFloat(document.getElementById('shipping').value) || 0;
        
        const discountAmount = subtotal * discount / 100;
        const vatAmount = subtotal * vat / 100;
        const total = subtotal - discountAmount + vatAmount + shipping;
        
        yPos += 10;
        doc.text(`Subtotal:`, 130, yPos);
        doc.text(`${subtotal.toFixed(2)}`, 175, yPos);
        
        yPos += 7;
        doc.text(`Discount (${discount}%):`, 130, yPos);
        doc.text(`-${discountAmount.toFixed(2)}`, 175, yPos);
        
        yPos += 7;
        doc.text(`VAT (${vat}%):`, 130, yPos);
        doc.text(`${vatAmount.toFixed(2)}`, 175, yPos);
        
        yPos += 7;
        doc.text(`Shipping:`, 130, yPos);
        doc.text(`${shipping.toFixed(2)}`, 175, yPos);
        
        // Total
        yPos += 15;
        doc.setFillColor(...primaryColor);
        doc.rect(120, yPos - 5, 75, 10, 'F');
        
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(12);
        doc.setFont("helvetica", "bold");
        doc.text(`TOTAL: ${total.toFixed(2)}`, 125, yPos + 2);
        
        // Notes
        const notes = document.getElementById('notes').value;
        if (notes) {
          yPos += 20;
          doc.setTextColor(...textColor);
          doc.setFontSize(10);
          doc.setFont("helvetica", "normal");
          doc.text(`Notes: ${notes}`, 15, yPos);
        }
        
        // Footer
        yPos = 280;
        doc.setTextColor(100, 100, 100);
        doc.setFontSize(9);
        doc.text('Thank you for your business!', 105, yPos, { align: 'center' });
        doc.text('Prime E-Store - Quality Electronic Components | +880 179-554-1326', 105, yPos + 5, { align: 'center' });
        
        // Save the PDF
        const fileName = `${document.getElementById('orderId').value}.pdf`;
        doc.save(fileName);
        
      } catch (error) {
        console.error("Error generating PDF:", error);
        throw new Error("Failed to generate invoice");
      }
    }

    function resetForm() {
      // Clear cart
      cart.clear();
      
      // Reset form fields
      document.getElementById('shopName').value = '';
      document.getElementById('phone').value = '';
      document.getElementById('address').value = '';
      document.getElementById('notes').value = '';
      document.getElementById('discount').value = '0';
      document.getElementById('vat').value = '0';
      document.getElementById('shipping').value = '0';
      document.getElementById('searchInput').value = '';
      
      // Generate new order ID and date
      generateOrderId();
      setOrderDate();
      
      // Re-render products
      renderProducts();
      updateTotal();
      
      // Show notification
      showNotification("Order reset. You can start a new order.");
    }

    // Admin Panel Functions
    function adminLogin() {
        const username = adminUsername.value.trim();
        const password = adminPassword.value.trim();
        
        if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
            isAdminLoggedIn = true;
            
            // Save login state to localStorage
            localStorage.setItem('isAdminLoggedIn', 'true');
            
            showNotification("Admin login successful");
            
            // Clear login fields
            adminUsername.value = '';
            adminPassword.value = '';
            
            // Switch to dashboard tab
            document.querySelector('.admin-tab[data-tab="dashboard"]').click();
            
            // Load admin dashboard data
            loadAdminDashboard();
        } else {
            showNotification("Invalid admin credentials", true);
        }
    }

    function adminLogout() {
        isAdminLoggedIn = false;
        
        // Remove login state from localStorage
        localStorage.removeItem('isAdminLoggedIn');
        
        showNotification("Admin logged out");
        document.querySelector('.admin-tab[data-tab="login"]').click();
    }

    // Check for saved login state on page load
    function checkLoginState() {
        const savedLoginState = localStorage.getItem('isAdminLoggedIn');
        if (savedLoginState === 'true') {
            isAdminLoggedIn = true;
            document.querySelector('.admin-tab[data-tab="dashboard"]').click();
            loadAdminDashboard();
        }
    }

    function loadAdminDashboard() {
        if (!isAdminLoggedIn) return;
        
        // Get filter values
        const statusFilterValue = statusFilter.value;
        const dateFilterValue = dateFilter.value;
        const searchFilterValue = searchFilter.value.toLowerCase();
        
        // Get today's date for filtering
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        // Filter orders
        let filteredOrders = [...orders];
        
        // Apply status filter
        if (statusFilterValue !== 'all') {
            filteredOrders = filteredOrders.filter(order => order.status === statusFilterValue);
        }
        
        // Apply date filter
        switch (dateFilterValue) {
            case 'today':
                filteredOrders = filteredOrders.filter(order => {
                    const orderDate = new Date(order.date);
                    orderDate.setHours(0, 0, 0, 0);
                    return orderDate.getTime() === today.getTime();
                });
                break;
            case 'yesterday':
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                filteredOrders = filteredOrders.filter(order => {
                    const orderDate = new Date(order.date);
                    orderDate.setHours(0, 0, 0, 0);
                    return orderDate.getTime() === yesterday.getTime();
                });
                break;
            case 'week':
                const oneWeekAgo = new Date(today);
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                filteredOrders = filteredOrders.filter(order => {
                    const orderDate = new Date(order.date);
                    return orderDate >= oneWeekAgo;
                });
                break;
            case 'month':
                const oneMonthAgo = new Date(today);
                oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                filteredOrders = filteredOrders.filter(order => {
                    const orderDate = new Date(order.date);
                    return orderDate >= oneMonthAgo;
                });
                break;
            // 'all' - no date filtering needed
        }
        
        // Apply search filter
        if (searchFilterValue) {
            filteredOrders = filteredOrders.filter(order => 
                order.orderId.toLowerCase().includes(searchFilterValue) || 
                order.shopName.toLowerCase().includes(searchFilterValue) || 
                order.phone.toLowerCase().includes(searchFilterValue)
            );
        }
        
        // Sort by date (newest first)
        filteredOrders.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        // Update stats
        const todayOrders = orders.filter(order => {
            const orderDate = new Date(order.date);
            orderDate.setHours(0, 0, 0, 0);
            return orderDate.getTime() === today.getTime();
        });
        
        const pendingOrders = orders.filter(order => order.status === 'pending');
        const deliveredOrders = orders.filter(order => order.status === 'delivered');
        
        document.getElementById('todayOrdersStat').textContent = todayOrders.length;
        document.getElementById('todayRevenueStat').textContent = todayOrders.reduce((sum, order) => sum + order.total, 0).toFixed(2);
        document.getElementById('pendingOrdersStat').textContent = pendingOrders.length;
        document.getElementById('deliveredOrdersStat').textContent = deliveredOrders.length;
        
        // Load orders table
        const ordersTableBody = document.getElementById('ordersTableBody');
        ordersTableBody.innerHTML = '';
        
        if (filteredOrders.length === 0) {
            document.getElementById('noOrdersMessage').style.display = 'block';
        } else {
            document.getElementById('noOrdersMessage').style.display = 'none';
            
            filteredOrders.forEach(order => {
                const row = document.createElement('tr');
                
                // Format date for display
                const formattedDate = new Date(order.date).toLocaleString();
                
                // Get status badge class
                let statusClass = '';
                switch (order.status) {
                    case 'pending':
                        statusClass = 'status-pending';
                        break;
                    case 'processing':
                        statusClass = 'status-processing';
                        break;
                    case 'delivered':
                        statusClass = 'status-delivered';
                        break;
                    case 'cancelled':
                        statusClass = 'status-cancelled';
                        break;
                }
                
                row.innerHTML = `
                    <td>${order.orderId}</td>
                    <td>${order.shopName}</td>
                    <td>${order.phone}</td>
                    <td>${order.total.toFixed(2)}</td>
                    <td>
                        <select class="status-select ${statusClass}" data-order-id="${order.id}">
                            <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                    </td>
                    <td>${formattedDate}</td>
                    <td>
                        <div class="order-actions">
                            <button class="action-btn view" data-order-id="${order.id}">👁️ View</button>
                            <button class="action-btn print" data-order-id="${order.id}">🖨️ Print</button>
                            <button class="action-btn delete" data-order-id="${order.id}">🗑️ Delete</button>
                        </div>
                    </td>
                `;
                
                // Add event listener for status change
                const statusSelect = row.querySelector('.status-select');
                statusSelect.addEventListener('change', function(e) {
                    const newStatus = e.target.value;
                    const orderId = this.dataset.orderId;
                    
                    // Update status in Firebase
                    database.ref(`orders/${orderId}`).update({ status: newStatus })
                        .then(() => {
                            showNotification(`Order status updated to ${newStatus}`);
                            
                            // Update the UI
                            statusSelect.className = 'status-select';
                            switch (newStatus) {
                                case 'pending':
                                    statusSelect.classList.add('status-pending');
                                    break;
                                case 'processing':
                                    statusSelect.classList.add('status-processing');
                                    break;
                                case 'delivered':
                                    statusSelect.classList.add('status-delivered');
                                    break;
                                case 'cancelled':
                                    statusSelect.classList.add('status-cancelled');
                                    break;
                            }
                        })
                        .catch(error => {
                            console.error("Error updating status:", error);
                            showNotification("Failed to update order status", true);
                            e.target.value = order.status; // Revert to previous value
                        });
                });
                
                // Add event listeners for action buttons
                row.querySelector('.action-btn.view').addEventListener('click', () => showOrderDetailsModal(order));
                row.querySelector('.action-btn.print').addEventListener('click', () => printOrder(order));
                row.querySelector('.action-btn.delete').addEventListener('click', () => deleteOrder(order.id));
                
                ordersTableBody.appendChild(row);
            });
        }
    }

    function showOrderDetailsModal(order) {
      orderDetailsContent.innerHTML = `
        <div class="order-details">
          <div class="order-details-item">
            <span>Order ID:</span>
            <span>${order.orderId}</span>
          </div>
          <div class="order-details-item">
            <span>Status:</span>
            <select class="status-select" id="detailStatusSelect" data-order-id="${order.id}">
              <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
              <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
              <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
              <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
            </select>
          </div>
          <div class="order-details-item">
            <span>Date:</span>
            <span>${new Date(order.date).toLocaleString()}</span>
          </div>
          <div class="order-details-item">
            <span>Shop Name:</span>
            <span>${order.shopName}</span>
          </div>
          <div class="order-details-item">
            <span>Phone:</span>
            <span>${order.phone}</span>
          </div>
          ${order.address ? `
          <div class="order-details-item">
            <span>Address:</span>
            <span>${order.address}</span>
          </div>` : ''}
          ${order.notes ? `
          <div class="order-details-item">
            <span>Notes:</span>
            <span>${order.notes}</span>
          </div>` : ''}
          <div class="order-products">
            <h4>Products:</h4>
            ${order.products.map(product => `
              <div class="order-product">
                <span>${product.name}</span>
                <span>${product.quantity} × ${product.price.toFixed(2)} = ${(product.quantity * product.price).toFixed(2)}</span>
              </div>
            `).join('')}
          </div>
          <div class="order-details-item">
            <span>Subtotal:</span>
            <span>${order.subtotal.toFixed(2)}</span>
          </div>
          <div class="order-details-item">
            <span>Discount:</span>
            <span>-${order.discount.toFixed(2)}</span>
          </div>
          <div class="order-details-item">
            <span>VAT:</span>
            <span>${order.vat.toFixed(2)}</span>
          </div>
          <div class="order-details-item">
            <span>Shipping:</span>
            <span>${order.shipping.toFixed(2)}</span>
          </div>
          <div class="order-details-item" style="font-weight: bold;">
            <span>Total:</span>
            <span>${order.total.toFixed(2)}</span>
          </div>
        </div>
        <div class="action-buttons" style="margin-top: 20px;">
          <button class="btn btn-primary" onclick="printOrder(${JSON.stringify(order).replace(/"/g, '&quot;')})">
            <span>🖨️ Print Invoice</span>
          </button>
          <button class="btn btn-danger" onclick="deleteOrder('${order.id}')">
            <span>🗑️ Delete Order</span>
          </button>
        </div>
      `;
  
      // Add event listener for status change in details modal
      const statusSelect = document.getElementById('detailStatusSelect');
      statusSelect.addEventListener('change', function(e) {
        const newStatus = e.target.value;
        database.ref(`orders/${order.id}`).update({ status: newStatus })
          .then(() => {
            showNotification(`Order status updated to ${newStatus}`);
            // Update the order in local state
            const orderIndex = orders.findIndex(o => o.id === order.id);
            if (orderIndex !== -1) {
              orders[orderIndex].status = newStatus;
            }
            // Reload admin dashboard to reflect changes
            loadAdminDashboard();
            // Update the modal with new status
            showOrderDetailsModal(orders[orderIndex]);
          })
          .catch(error => {
            console.error("Error updating status:", error);
            showNotification("Failed to update order status", true);
            e.target.value = order.status; // Revert to previous value
          });
      });
  
      // Apply status-specific styling
      statusSelect.className = 'status-select';
      switch(order.status) {
        case 'pending':
          statusSelect.classList.add('status-pending');
          break;
        case 'processing':
          statusSelect.classList.add('status-processing');
          break;
        case 'delivered':
          statusSelect.classList.add('status-delivered');
          break;
        case 'cancelled':
          statusSelect.classList.add('status-cancelled');
          break;
      }
  
      orderModal.style.display = "block";
    }

    function printOrder(order) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
  
      // Set font and colors
      doc.setFont("helvetica");
      const primaryColor = [67, 97, 238];
      const textColor = [33, 37, 41];
  
      // Header Background
      doc.setFillColor(...primaryColor);
      doc.rect(0, 0, 210, 30, 'F');

      // Left Aligned - Company Info
      doc.setTextColor(255, 255, 255);
      doc.setFont("helvetica", "bold");
      doc.setFontSize(20);
      doc.text('PRIME E-STORE', 15, 12);

      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);
      doc.text('29. Sir Iqbal Road.', 15, 18);
      doc.text('Picture Palace More Khulna. 9100', 15, 24);

      // Right Aligned - Invoice Info
      doc.setFont("helvetica", "bold");
      doc.setFontSize(20);
      doc.text('INVOICE', 195, 12, { align: 'right' });

      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);
      doc.text('Email: er.mailer2@aol.com', 195, 18, { align: 'right' });
      doc.text('Phone: +880 179-554-1326', 195, 24, { align: 'right' });

      // Invoice Details Section
      let yPos = 40;
      doc.setTextColor(...textColor);
      doc.setFontSize(10);
  
      // Left Aligned - Invoice Details
      doc.text(`Invoice: ${order.orderId}`, 15, yPos);
      doc.text(`Date: ${new Date(order.date).toLocaleString()}`, 15, yPos + 6);

      // Right Aligned - Customer Info
      doc.setFont("helvetica", "bold");

      // BILL TO: and shop name in same line
      let billToText = 'BILL TO: ' + (order.shopName && order.shopName.trim() !== '' ? order.shopName : '');
      doc.text(billToText, 195, yPos, { align: 'right' });
      doc.setFont("helvetica", "normal");

      // Initialize vertical position for customer info
      let infoY = yPos + 6;

      // Phone (always shown)
      doc.text(`Phone: ${order.phone}`, 195, infoY, { align: 'right' });
      infoY += 6;

      // Address (if exists)
      if (order.address && order.address.trim() !== '') {
        doc.text(`Address: ${order.address}`, 195, infoY, { align: 'right' });
        infoY += 6;
      }

      // Update yPos for next section
      yPos = infoY;

      // Line separator
      yPos += 4;
      doc.setDrawColor(200, 200, 200);
      doc.setLineWidth(0.5);
      doc.line(15, yPos, 195, yPos);

      // Items Table Header
      yPos += 10;
      doc.setFont("helvetica", "bold");
      doc.setFontSize(12);
      doc.text('ITEMS', 15, yPos);
      doc.text('QTY', 120, yPos);
      doc.text('PRICE', 140, yPos);
      doc.text('TOTAL', 170, yPos);
      
      // Items table
      doc.setFont("helvetica", "normal");
      doc.setFontSize(10);
      yPos += 8;
      
      order.products.forEach(product => {
        const itemTotal = product.price * product.quantity;
        
        // Alternate row background
        if (yPos % 2 === 0) {
          doc.setFillColor(248, 248, 248);
          doc.rect(15, yPos - 5, 180, 8, 'F');
        }
        
        doc.text(product.name, 20, yPos);
        doc.text(product.quantity.toString(), 125, yPos);
        doc.text(`${product.price.toFixed(2)}`, 145, yPos);
        doc.text(`${itemTotal.toFixed(2)}`, 175, yPos);
        
        yPos += 8;
      });
      
      // Summary
      yPos += 10;
      doc.setDrawColor(200, 200, 200);
      doc.line(120, yPos, 195, yPos);
      
      yPos += 10;
      doc.text(`Subtotal:`, 130, yPos);
      doc.text(`${order.subtotal.toFixed(2)}`, 175, yPos);
      
      yPos += 7;
      doc.text(`Discount:`, 130, yPos);
      doc.text(`-${order.discount.toFixed(2)}`, 175, yPos);
      
      yPos += 7;
      doc.text(`VAT:`, 130, yPos);
      doc.text(`${order.vat.toFixed(2)}`, 175, yPos);
      
      yPos += 7;
      doc.text(`Shipping:`, 130, yPos);
      doc.text(`${order.shipping.toFixed(2)}`, 175, yPos);
      
      // Total
      yPos += 15;
      doc.setFillColor(...primaryColor);
      doc.rect(120, yPos - 5, 75, 10, 'F');
      
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(12);
      doc.setFont("helvetica", "bold");
      doc.text(`TOTAL: ${order.total.toFixed(2)}`, 125, yPos + 2);
      
      // Notes
      if (order.notes) {
        yPos += 20;
        doc.setTextColor(...textColor);
        doc.setFontSize(10);
        doc.setFont("helvetica", "normal");
        doc.text(`Notes: ${order.notes}`, 15, yPos);
      }
      
      // Footer
      yPos = 280;
      doc.setTextColor(100, 100, 100);
      doc.setFontSize(9);
      doc.text('Thank you for your business!', 105, yPos, { align: 'center' });
      doc.text('Prime E-Store - Quality Electronic Components | +880 179-554-1326', 105, yPos + 5, { align: 'center' });
      
      // Status
      yPos += 15;
      doc.setFontSize(10);
      doc.setFont("helvetica", "bold");
      doc.text(`Status: ${order.status.toUpperCase()}`, 15, yPos);
      
      // Save the PDF
      const fileName = `${order.orderId}.pdf`;
      doc.save(fileName);
    }

    function deleteOrder(orderId) {
      if (confirm(`Are you sure you want to delete order ${orderId}? This cannot be undone.`)) {
        database.ref(`orders/${orderId}`).remove()
          .then(() => {
            showNotification(`Order ${orderId} deleted successfully`);
    
            // Remove the order from local state immediately
            orders = orders.filter(order => order.id !== orderId);
    
            // Update the admin dashboard table
            loadAdminDashboard();
    
            // Close the modal if open
            if (orderModal.style.display === "block") {
              orderModal.style.display = "none";
            }
    
            // Update today's order count
            const today = new Date().toLocaleDateString();
            totalOrdersToday = orders.filter(order => {
              const orderDate = new Date(order.date).toLocaleDateString();
              return orderDate === today;
            }).length;
            updateOrderCounter();
          })
          .catch(error => {
            console.error("Error deleting order:", error);
            showNotification("Failed to delete order", true);
          });
      }
    }

    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
